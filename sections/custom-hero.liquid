

{% liquid
  assign media_count = 0
  assign media_count_mobile = 0
  assign fallback_to_desktop = false
  assign media_1 = 'none'
  assign media_2 = 'none'
  assign media_1_mobile = 'none'
  assign media_2_mobile = 'none'
  assign has_only_video = false
  assign has_only_video_mobile = false

  # Desktop media checks
  # For each media slot, check if the media is not blank and the media type matches the slot
  # Need to check both (1) media picker is not blank AND (2) section.setting.media_type because user can toggle between different media types to display, but choosing "Image" doesn't clear a saved "Video" in the theme editor.
  # The alternate setting (section.settings.image_1 when "Video" is selected) is only visually hidden in theme editor.
  if section.settings.image_1 != blank and section.settings.media_type_1 == 'image'
    assign media_1 = 'image'
    assign media_count = media_count | plus: 1
  endif
  if section.settings.video_1 != blank and section.settings.media_type_1 == 'video'
    assign media_1 = 'video'
    assign media_count = media_count | plus: 1
  endif
  if section.settings.image_2 != blank and section.settings.media_type_2 == 'image'
    assign media_2 = 'image'
    assign media_count = media_count | plus: 1
  endif
  if section.settings.video_2 != blank and section.settings.media_type_2 == 'video'
    assign media_2 = 'video'
    assign media_count = media_count | plus: 1
  endif

  if section.settings.custom_mobile_media
    # Mobile media checks
    # For each media slot, check if the media is not blank and the media type matches the slot
    if section.settings.image_1_mobile != blank and section.settings.media_type_1_mobile == 'image'
      assign media_1_mobile = 'image'
      assign media_count_mobile = media_count_mobile | plus: 1
    endif
    if section.settings.video_1_mobile != blank and section.settings.media_type_1_mobile == 'video'
      assign media_1_mobile = 'video'
      assign media_count_mobile = media_count_mobile | plus: 1
    endif
    if section.settings.image_2_mobile != blank and section.settings.media_type_2_mobile == 'image'
      assign media_2_mobile = 'image'
      assign media_count_mobile = media_count_mobile | plus: 1
    endif
    if section.settings.video_2_mobile != blank and section.settings.media_type_2_mobile == 'video'
      assign media_2_mobile = 'video'
      assign media_count_mobile = media_count_mobile | plus: 1
    endif
  endif
  if media_count > 0 and media_1 != 'image' and media_2 != 'image'
    assign has_only_video = true
  endif
  if media_count > 0 and media_count_mobile > 0 and media_1_mobile != 'image' and media_2_mobile != 'image'
    assign has_only_video_mobile = true
  endif

  assign media_wrapper_desktop_class = 'hero__media-wrapper hero__media-wrapper--desktop'
  assign media_wrapper_mobile_class = 'hero__media-wrapper hero__media-wrapper--mobile'
  # If there is no custom mobile media to show, we add the mobile class to the desktop classes so content is always shown on mobile.
  if section.settings.custom_mobile_media == false or section.settings.custom_mobile_media == true and media_count_mobile == 0
    assign media_wrapper_desktop_class = media_wrapper_desktop_class | append: ' hero__media-wrapper--mobile'
  endif

  # Should we show the blurred reflection on mobile?
  assign show_mobile_blurred_reflection = false
  if section.settings.blurred_reflection
    if section.settings.custom_mobile_media == true and media_count_mobile > 0 and has_only_video_mobile == false
      # Custom mobile media is active and a mobile image is present
      assign show_mobile_blurred_reflection = true
    elsif section.settings.custom_mobile_media == true and media_count_mobile == 0 and media_count > 0 and has_only_video == false
      # Custom mobile media is active, no mobile media is present, but a desktop image is present
      assign show_mobile_blurred_reflection = true
    elsif section.settings.custom_mobile_media == false and media_count > 0 and has_only_video == false
      # Custom mobile media is inactive, but a desktop image is present
      assign show_mobile_blurred_reflection = true
    endif
  endif

  if media_1 == 'image' and media_2 == 'image'
    assign media_width_desktop = '50vw'
  else
    assign media_width_desktop = '100vw'
  endif

  # If custom mobile media is disabled or no mobile media is present, we need to fallback to desktop media.
  if section.settings.custom_mobile_media == false or media_count_mobile == 0 or media_count == 0
    assign media_count_mobile = media_count
    assign fallback_to_desktop = true
  endif

  if fallback_to_desktop
    assign media_width_mobile = media_width_desktop
  elsif section.settings.stack_media_on_mobile or media_1_mobile != 'image' or media_2_mobile != 'image'
    assign media_width_mobile = '100vw'
  else
    assign media_width_mobile = '50vw'
  endif

  assign sizes = '(min-width: 750px) ' | append: media_width_desktop | append: ', ' | append: media_width_mobile
  assign widths = '832, 1200, 1600, 1920, 2560, 3840'
  assign sizes_mobile = media_width_mobile
  assign mobile_widths = '416, 600, 800, 1200, 1600'
  assign mobile_widths_array = mobile_widths | split: ', '

  assign fetch_priority = 'auto'

  if section.index == 1
    assign fetch_priority = 'high'
  endif
%}

{% capture media_slot_1 %}
  {%- if media_1 == 'image' and media_1_mobile == 'image' -%}
    {%- comment -%} Both desktop and mobile are images. Assume similar images, and this is art direction: use picture element. {%- endcomment -%}
    <picture
      data-testid="hero-picture-1"
      class="hero__media"
    >
      <source
        media="(max-width: 749px)"
        srcset="
          {%-  for mobile_width in mobile_widths_array -%}
            {{ section.settings.image_1_mobile | image_url: width: mobile_width }} {{ mobile_width }}w{% unless forloop.last %},{% endunless %}
          {%- endfor -%}
        "
        sizes="{{ sizes_mobile }}"
        width="{{ section.settings.image_1_mobile.width }}"
        height="{{ section.settings.image_1_mobile.height }}"
      >
      {{
        section.settings.image_1
        | image_url: width: 3840
        | image_tag:
          width: section.settings.image_1.width,
          widths: widths,
          height: section.settings.image_1.height,
          alt: section.settings.image_1.alt,
          class: 'hero__media',
          sizes: sizes,
          fetchpriority: fetch_priority,
          data-testid: 'hero-desktop-image-1'
      }}
    </picture>
  {%- elsif media_1 == 'image' -%}
    <div class="{{ media_wrapper_desktop_class }}">
      {{
        section.settings.image_1
        | image_url: width: 3840
        | image_tag:
          width: section.settings.image_1.width,
          widths: widths,
          height: section.settings.image_1.height,
          alt: section.settings.image_1.alt,
          class: 'hero__media',
          sizes: sizes,
          fetchpriority: fetch_priority,
          data-testid: 'hero-desktop-image-1'
      }}
    </div>
  {%- endif -%}

  {%- if media_1 == 'video' -%}
    <div class="{{ media_wrapper_desktop_class }}">
      {{
        section.settings.video_1
        | video_tag:
          poster: nil,
          autoplay: true,
          loop: true,
          controls: false,
          muted: true,
          class: 'hero__media',
          data-testid: 'hero-desktop-video-1'
      }}
    </div>
  {%- endif -%}

  {%- comment -%} Mobile-only slot 1 media (when desktop is different type) {%- endcomment -%}
  {%- if media_count > 0 and media_count_mobile > 0 -%}
    {%- if media_1_mobile == 'image' and media_1 != 'image' -%}
      <div class="{{ media_wrapper_mobile_class }}">
        {{
          section.settings.image_1_mobile
          | image_url: width: 1600
          | image_tag:
            width: section.settings.image_1_mobile.width,
            widths: mobile_widths,
            height: section.settings.image_1_mobile.height,
            alt: section.settings.image_1_mobile.alt,
            class: 'hero__media',
            sizes: sizes_mobile,
            fetchpriority: fetch_priority,
            data-testid: 'hero-mobile-image-1'
        }}
      </div>
    {%- endif -%}

    {%- if media_1_mobile == 'video' -%}
      <div class="{{ media_wrapper_mobile_class }}">
        {{
          section.settings.video_1_mobile
          | video_tag:
            poster: nil,
            autoplay: true,
            loop: true,
            controls: false,
            muted: true,
            class: 'hero__media',
            data-testid: 'hero-mobile-video-1'
        }}
      </div>
    {%- endif -%}
  {%- endif -%}
{% endcapture %}

{% capture media_slot_2 %}
  {%- if media_2 == 'image' and media_2_mobile == 'image' -%}
    {%- comment -%} Both desktop and mobile are images. Assume this is art direction: use picture element.  {%- endcomment -%}
    <picture
      class="hero__media"
      data-testid="hero-picture-2"
    >
      <source
        media="(max-width: 749px)"
        srcset="
          {%-  for mobile_width in mobile_widths_array -%}
            {{ section.settings.image_2_mobile | image_url: width: mobile_width }} {{ mobile_width }}w{% unless forloop.last%},{% endunless %}
          {%- endfor -%}
        "
        sizes="{{ sizes_mobile }}"
        width="{{ section.settings.image_2_mobile.width }}"
        height="{{ section.settings.image_2_mobile.height }}"
      >
      {{
        section.settings.image_2
        | image_url: width: 3840
        | image_tag:
          width: section.settings.image_2.width,
          widths: widths,
          height: section.settings.image_2.height,
          alt: section.settings.image_2.alt,
          class: 'hero__media',
          sizes: sizes,
          fetchpriority: fetch_priority,
          data-testid: 'hero-desktop-image-2'
      }}
    </picture>
  {%- elsif media_2 == 'image' -%}
    <div class="{{ media_wrapper_desktop_class }}">
      {{
        section.settings.image_2
        | image_url: width: 3840
        | image_tag:
          width: section.settings.image_2.width,
          widths: widths,
          height: section.settings.image_2.height,
          alt: section.settings.image_2.alt,
          class: 'hero__media',
          sizes: sizes,
          fetchpriority: fetch_priority,
          data-testid: 'hero-desktop-image-2'
      }}
    </div>
  {%- endif -%}

  {%- if media_2 == 'video' -%}
    <div class="{{ media_wrapper_desktop_class }}">
      {{
        section.settings.video_2
        | video_tag:
          poster: nil,
          autoplay: true,
          loop: true,
          controls: false,
          muted: true,
          class: 'hero__media',
          data-testid: 'hero-desktop-video-2'
      }}
    </div>
  {%- endif -%}

  {%- comment -%} Mobile-only slot 2 media (when desktop is different type) {%- endcomment -%}
  {%- if media_count > 0 and media_count_mobile > 0 -%}
    {%- if media_2_mobile == 'image' and media_2 != 'image' -%}
      <div class="{{ media_wrapper_mobile_class }}">
        {{
          section.settings.image_2_mobile
          | image_url: width: 1600
          | image_tag:
            width: section.settings.image_2_mobile.width,
            widths: mobile_widths,
            height: section.settings.image_2_mobile.height,
            alt: section.settings.image_2_mobile.alt,
            class: 'hero__media',
            sizes: sizes_mobile,
            fetchpriority: fetch_priority,
            data-testid: 'hero-mobile-image-2'
        }}
      </div>
    {%- endif -%}

    {%- if media_2_mobile == 'video' -%}
      <div class="{{ media_wrapper_mobile_class }}">
        {{
          section.settings.video_2_mobile
          | video_tag:
            poster: nil,
            autoplay: true,
            loop: true,
            controls: false,
            muted: true,
            class: 'hero__media',
            data-testid: 'hero-mobile-video-2'
        }}
      </div>
    {%- endif -%}
  {%- endif -%}
{% endcapture %}

{% capture media %}
  {{ media_slot_1 }}
  {{ media_slot_2 }}

  {% if media_count == 0 %}
    {{ 'hero-apparel-1' | placeholder_svg_tag: 'hero__media' }}
  {%- endif -%}
{% endcapture %}

{% capture media_blurred %}
  {% if media_1 == 'image' %}
    {{
      section.settings.image_1
      | image_url: width: 3840
      | image_tag:
        width: section.settings.image_1.width,
        widths: widths,
        height: section.settings.image_1.height,
        alt: '',
        class: 'hero__media',
        sizes: sizes
    }}
  {% endif %}
  {% if media_2 == 'image' %}
    {{
      section.settings.image_2
      | image_url: width: 3840
      | image_tag:
        width: section.settings.image_2.width,
        widths: widths,
        height: section.settings.image_2.height,
        alt: '',
        class: 'hero__media',
        sizes: sizes
    }}
  {% endif %}
  {% if media_count == 0 %}
    {{ 'hero-apparel-1' | placeholder_svg_tag: 'hero__media' }}
  {% endif %}
{% endcapture %}

{% capture mobile_media_blurred %}
  {%- comment -%}
    On mobile we need to check:
    1. If the media should be stacked. If it is,we check for the second (bottom) image first, then for the first (top) image.
    2. If custom mobile setting is active and has media (show desktop media otherwise).
  {%- endcomment -%}
  {% if section.settings.stack_media_on_mobile == false %}
    {% if section.settings.custom_mobile_media == true and fallback_to_desktop == false %}
      {% if media_1_mobile == 'image' %}
        {{ section.settings.image_1_mobile
          | image_url: width: 1600
          | image_tag: width: section.settings.image_1_mobile.width,
            widths: mobile_widths,
            height: section.settings.image_1_mobile.height,
            alt: '',
            class: 'hero__media',
            sizes: sizes_mobile
          }}
      {% endif %}
      {% if media_2_mobile == 'image' %}
        {{ section.settings.image_2_mobile
          | image_url: width: 1600
          | image_tag: width: section.settings.image_2_mobile.width,
            widths: mobile_widths,
            height: section.settings.image_2_mobile.height,
            alt: '',
            class: 'hero__media',
            sizes: sizes_mobile
          }}
      {% endif %}
    {% elsif fallback_to_desktop %}
      {{ media_blurred }}
    {% endif %}
  {% elsif section.settings.stack_media_on_mobile == true %}
    {% if section.settings.custom_mobile_media == true and fallback_to_desktop == false %}
      {% if media_2_mobile == 'image' %}
        {{ section.settings.image_2_mobile
          | image_url: width: 1600
          | image_tag: width: section.settings.image_2_mobile.width,
            widths: mobile_widths,
            height: section.settings.image_2_mobile.height,
            alt: '',
            class: 'hero__media',
            sizes: sizes_mobile
        }}
      {% elsif media_1_mobile == 'image' %}
        {{ section.settings.image_1_mobile
          | image_url: width: 1600
          | image_tag: width: section.settings.image_1_mobile.width,
            widths: mobile_widths,
            height: section.settings.image_1_mobile.height,
            alt: '',
            class: 'hero__media',
            sizes: sizes_mobile
          }}
      {% endif %}
    {% elsif fallback_to_desktop %}
      {% if media_count > 0 %}
        {% if media_2 == 'image' %}
          {{ section.settings.image_2
            | image_url: width: 1600
            | image_tag: width: section.settings.image_2.width,
              widths: widths,
              height: section.settings.image_2.height,
              alt: '',
              class: 'hero__media',
              sizes: sizes
            }}
        {% elsif media_1 == 'image' %}
          {{ section.settings.image_1
            | image_url: width: 1600
            | image_tag: width: section.settings.image_1.width,
              widths: widths,
              height: section.settings.image_1.height,
              alt: '',
              class: 'hero__media',
              sizes: sizes
            }}
        {% endif %}
        {% if media_count == 0 %}
          {{ 'hero-apparel-1' | placeholder_svg_tag: 'hero__media' }}
        {% endif %}
      {% endif %}
    {% endif %}
  {% endif %}
{% endcapture %}

<div
  id="Hero-{{ section.id }}"
  class="hero color-{{ section.settings.color_scheme }}{% if section.blocks.size == 0 and section.settings.section_height == 'auto' %} hero--no-blocks-auto-height{% endif %}{% if section.settings.stack_media_on_mobile %} hero--stack-mobile{% endif %}"
  style="
    --hero-border-style: {{ section.settings.border }};
    --hero-border-width: {{ section.settings.border_width }}px;
    --hero-border-opacity: {{ section.settings.border_opacity }}%;
    --blur-opacity: {{ section.settings.reflection_opacity | divided_by: 100.0 }};
    {% if section.settings.section_height == 'custom' %}
      --hero-min-height: {{ section.settings.section_height_custom }}svh;
    {% elsif section.settings.section_height == "full-screen" %}
       --hero-min-height: 100svh;
    {% else %}
      --hero-min-height: var(--section-height-{{ section.settings.section_height }});
    {% endif %}
  "
  {% if request.visual_preview_mode %}
    data-shopify-visual-preview
  {% endif %}
  {% if section.settings.blurred_reflection and has_only_video == false or has_only_video_mobile == false %}
    data-blur-shadow="true"
  {% endif %}
>
  
<section class="hero">
  <video autoplay muted loop playsinline class="hero__video">
    <source src="{{ section.settings.hero_video | file_url }}" type="video/mp4">
  </video>
  <div class="hero__content">
    <h1>{{ section.settings.hero_heading }}</h1>
    <p>{{ section.settings.hero_subheading }}</p>
    <a href="{{ section.settings.hero_button_link }}" class="btn">{{ section.settings.hero_button_text }}</a>
  </div>
</section>
  
</div>

{% stylesheet %}
  .hero-wrapper {
    --hero-height-offset: 0px;
  }

  /* Being extra specific in the selector for performance reasons */
  body:has(> #header-group > .header-section > #header-component) .hero-wrapper:first-child {
    --hero-height-offset: var(--header-group-height, 0);
  }

  .hero {
    position: relative;
    min-height: calc(var(--hero-min-height) - var(--hero-height-offset));
  }

  .hero[data-shopify-visual-preview] {
    --hero-min-height: 600px;

    min-height: 600px;
  }

  .hero__container {
    position: relative;
    overflow: hidden;
    border: var(--hero-border-width) var(--hero-border-style) rgb(var(--color-border-rgb) / var(--hero-border-opacity));
    min-height: inherit;
    align-items: var(--vertical-alignment-mobile);
    justify-content: var(--horizontal-alignment);
    z-index: var(--layer-base);

    @media screen and (min-width: 750px) {
      align-items: var(--vertical-alignment);
    }
  }

  .hero__content-wrapper.page-width {
    grid-column: 2 / 3;
  }

  .hero__content-wrapper {
    position: relative;
    inset: 0;
    z-index: var(--layer-flat);
  }

  .hero__content-wrapper .group-block-content {
    position: relative;
  }

  .hero__media-grid {
    position: absolute;
    inset: 0;
    display: grid;
    grid-column: 1 / -1;
    grid-template-columns: repeat(var(--hero-media-count, 1), 1fr);
  }

  .hero--auto .hero__media {
    aspect-ratio: var(--hero-media-aspect-ratio);
  }

  .hero--no-blocks-auto-height {
    .hero__media {
      width: 100%;
      aspect-ratio: auto;
    }

    .hero__media-grid {
      /* When there are no blocks and the height is auto, allow the image to appear. */
      position: relative;
    }
  }

  .hero__media-wrapper {
    overflow: hidden;
    position: relative;
  }

  .hero__media {
    height: 100%;
    width: 100%;
    object-fit: cover;
    object-position: center center;
    overflow: hidden;
    position: relative;
    z-index: var(--layer-base);
  }

  /* Mobile/Desktop media visibility */

  .hero__media-wrapper--mobile {
    display: none;
  }

  .hero__media-wrapper--desktop {
    display: block;
  }

  @media screen and (max-width: 749px) {
    .hero__media-wrapper--desktop {
      display: none;
    }

    .hero__media-wrapper--mobile {
      display: block;
    }

    .hero__media-grid {
      grid-template-columns: repeat(var(--hero-media-count-mobile, 1), 1fr);
    }

    /* Mobile stacking */
    .hero--stack-mobile .hero__media-grid {
      grid-template-columns: 1fr;
      grid-template-rows: repeat(var(--hero-media-count-mobile, 1), calc(100% / var(--hero-media-count-mobile, 1)));
    }
  }

  .hero__link {
    position: absolute;
    inset: 0;
    grid-column: 1 / -1;
  }

  .hero__media-grid,
  .hero__content-wrapper {
    pointer-events: none;

    :is(a, button, input, textarea, select, details, summary) {
      pointer-events: auto;
    }
  }

  .hero__content-wrapper--design-mode * {
    pointer-events: auto;
  }

  .hero[data-blur-shadow='true'] {
    --blurred-reflection-filter-saturate: saturate(1.5);
    --blurred-reflection-mask-image: linear-gradient(to bottom, #000 0%, #000 60%, transparent 100%);
    --blurred-reflection-box-shadow: rgb(0 0 0 / 5%) 0 0 1rem;
    --blurred-reflection-filter-blur: blur(20px);
    --blurred-reflection-scale: scale(2, 1.25);
    --blurred-reflection-padding-block-end: 60px;
  }

  .hero[data-blur-shadow='true'] .hero__container::before {
    content: '';
    position: absolute;
    inset: 0;
    box-shadow: var(--blurred-reflection-box-shadow);
    mix-blend-mode: overlay;
    pointer-events: none;
    z-index: -1;
  }

  .hero__blurred-image {
    position: absolute;
    inset: 0;
    z-index: -1;
    mask-image: var(--blurred-reflection-mask-image);
    filter: var(--blurred-reflection-filter-saturate);
    pointer-events: none;
    transform: translateY(50%);
    overflow: hidden;
  }

  .hero__blurred-image--desktop {
    display: none;

    @media screen and (min-width: 750px) {
      display: block;
    }
  }

  .hero__blurred-image--mobile {
    display: block;

    @media screen and (min-width: 750px) {
      display: none;
    }
  }

  .hero__blurred-image img,
  .hero__blurred-image svg {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: center center;
    filter: var(--blurred-reflection-filter-blur);
    opacity: var(--blur-opacity);
    transform: var(--blurred-reflection-scale);
    padding-block-end: var(--blurred-reflection-padding-block-end);

    &:not(:only-child) {
      width: 50%;

      &:last-child {
        right: 0;
        left: auto;
      }
    }
  }
{% endstylesheet %}

{% schema %}
{
  "name": "Custom Hero",
  "settings": [
    {
      "type": "video",
      "id": "hero_video",
      "label": "Background Video"
    },
    {
      "type": "text",
      "id": "hero_heading",
      "label": "Heading"
    },
    {
      "type": "text",
      "id": "hero_subheading",
      "label": "Subheading"
    },
    {
      "type": "text",
      "id": "hero_button_text",
      "label": "Button Text"
    },
    {
      "type": "url",
      "id": "hero_button_link",
      "label": "Button Link"
    }
  ]
}
{% endschema %}
